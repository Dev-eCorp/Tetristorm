var canvas,ctx,pieza,FPS=60,ancho_canvas=400,alto_canvas=640,ancho_tablero=10,alto_tablero=20,ancho_f=40,alto_f=40,margen_superior=4,tablero=[[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1]],tablero_limpio=[[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1]],ficha_grafico=[[[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]]],[[[0,0,2,0],[0,0,2,0],[0,0,2,0],[0,0,2,0]],[[0,0,0,0],[2,2,2,2],[0,0,0,0],[0,0,0,0]],[[0,0,2,0],[0,0,2,0],[0,0,2,0],[0,0,2,0]],[[0,0,0,0],[2,2,2,2],[0,0,0,0],[0,0,0,0]]],[[[0,0,0,0],[0,0,3,3],[0,3,3,0],[0,0,0,0]],[[0,0,3,0],[0,0,3,3],[0,0,0,3],[0,0,0,0]],[[0,0,0,0],[0,0,3,3],[0,3,3,0],[0,0,0,0]],[[0,0,3,0],[0,0,3,3],[0,0,0,3],[0,0,0,0]]],[[[0,0,0,0],[0,4,4,0],[0,0,4,4],[0,0,0,0]],[[0,0,0,4],[0,0,4,4],[0,0,4,0],[0,0,0,0]],[[0,0,0,0],[0,4,4,0],[0,0,4,4],[0,0,0,0]],[[0,0,0,4],[0,0,4,4],[0,0,4,0],[0,0,0,0]]],[[[0,0,0,0],[0,5,5,5],[0,5,0,0],[0,0,0,0]],[[0,0,5,0],[0,0,5,0],[0,0,5,5],[0,0,0,0]],[[0,0,0,5],[0,5,5,5],[0,0,0,0],[0,0,0,0]],[[0,5,5,0],[0,0,5,0],[0,0,5,0],[0,0,0,0]]],[[[0,0,0,0],[0,6,6,6],[0,0,0,6],[0,0,0,0]],[[0,0,6,6],[0,0,6,0],[0,0,6,0],[0,0,0,0]],[[0,6,0,0],[0,6,6,6],[0,0,0,0],[0,0,0,0]],[[0,0,6,0],[0,0,6,0],[0,6,6,0],[0,0,0,0]]],[[[0,0,0,0],[0,7,7,7],[0,0,7,0],[0,0,0,0]],[[0,0,7,0],[0,0,7,7],[0,0,7,0],[0,0,0,0]],[[0,0,7,0],[0,7,7,7],[0,0,0,0],[0,0,0,0]],[[0,0,7,0],[0,7,7,0],[0,0,7,0],[0,0,0,0]]]];function limpiar_tablero(){for(py=0;py<21;py++)for(px=0;px<12;px++)tablero[py][px]=tablero_limpio[py][px]}var objPieza=function(){this.x=0,this.y=0,this.angulo=0,this.tipo=6,this.retraso=50,this.fotograma=0,this.nueva=function(){this.tipo=Math.floor(7*Math.random()),this.y=0,this.x=4},this.pierde_partida=function(){var i=!1;for(px=1;px<ancho_tablero+1;px++)tablero[2][px]>0&&(i=!0,alert("Has perdido :("));return i},this.limpia=function(){var i;for(py=margen_superior;py<alto_tablero;py++){for(i=!0,px=1;px<ancho_tablero+1;px++)0==tablero[py][px]&&(i=!1);if(i)for(px=1;px<ancho_tablero+1;px++)tablero[py][px]=0}},this.caer=function(){this.fotograma<this.retraso?this.fotograma++:(this.colision(this.angulo,this.y+1,this.x)?(this.fijar(),this.limpia(),this.nueva(),this.pierde_partida()&&limpiar_tablero()):(this.y++,this.fotograma=0),this.fotograma=0)},this.fijar=function(){for(py=0;py<4;py++)for(px=0;px<4;px++)ficha_grafico[this.tipo][this.angulo][py][px]>0&&(tablero[this.y+py][this.x+px]=ficha_grafico[this.tipo][this.angulo][py][px])},this.colision=function(i,t,a){var o=!1;for(py=0;py<4;py++)for(px=0;px<4;px++)ficha_grafico[this.tipo][i][py][px]>0&&tablero[t+py][a+px]>0&&(o=!0);return o},this.dibuja=function(){for(py=0;py<4;py++)for(px=0;px<4;px++)0!=ficha_grafico[this.tipo][this.angulo][py][px]&&(1==ficha_grafico[this.tipo][this.angulo][py][px]&&(ctx.fillStyle="#800080"),2==ficha_grafico[this.tipo][this.angulo][py][px]&&(ctx.fillStyle="#FF8C00"),3==ficha_grafico[this.tipo][this.angulo][py][px]&&(ctx.fillStyle="#FFD700"),4==ficha_grafico[this.tipo][this.angulo][py][px]&&(ctx.fillStyle="#008000"),5==ficha_grafico[this.tipo][this.angulo][py][px]&&(ctx.fillStyle="#00CED1"),6==ficha_grafico[this.tipo][this.angulo][py][px]&&(ctx.fillStyle="#0000CD"),7==ficha_grafico[this.tipo][this.angulo][py][px]&&(ctx.fillStyle="#FF0000"),ctx.fillRect((this.x+px-1)*ancho_f,(this.y+py-margen_superior)*alto_f,ancho_f,alto_f))},this.rotar=function(){var i=this.angulo;i<3?i++:i=0,this.colision(i,this.y,this.x)||(this.angulo=i)},this.abajo=function(){this.colision(this.angulo,this.y+1,this.x)||this.y++},this.derecha=function(){this.colision(this.angulo,this.y,this.x+1)||this.x++},this.izquierda=function(){this.colision(this.angulo,this.y,this.x-1)||this.x--},this.nueva()};function dibujar_tablero(){for(py=margen_superior;py<alto_tablero;py++)for(px=1;px<ancho_tablero+1;px++)0!=tablero[py][px]&&(1==tablero[py][px]&&(ctx.fillStyle="#800080"),2==tablero[py][px]&&(ctx.fillStyle="#FF8C00"),3==tablero[py][px]&&(ctx.fillStyle="#FFD700"),4==tablero[py][px]&&(ctx.fillStyle="#008000"),5==tablero[py][px]&&(ctx.fillStyle="#00CED1"),6==tablero[py][px]&&(ctx.fillStyle="#0000CD"),7==tablero[py][px]&&(ctx.fillStyle="#FF0000"),ctx.fillRect((px-1)*ancho_f,(py-margen_superior)*alto_f,ancho_f,alto_f))}function teclado(){document.addEventListener("keydown",function(i){38==i.keyCode&&pieza.rotar(),40==i.keyCode&&pieza.abajo(),39==i.keyCode&&pieza.derecha(),37==i.keyCode&&pieza.izquierda()})}function inicializa(){canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),canvas.width=ancho_canvas,canvas.height=alto_canvas,pieza=new objPieza,teclado(),setInterval(function(){principal()},1e3/FPS)}function limpiar_canvas(){canvas.width=ancho_canvas,canvas.height=alto_canvas}function principal(){limpiar_canvas(),dibujar_tablero(),pieza.caer(),pieza.dibuja()}